# ğŸ”„ NeuroScan AI å®Œæ•´å·¥ä½œæµæŒ‡å—

## ğŸ“‹ ç›®å½•

1. [ç³»ç»Ÿæ¦‚è¿°](#ç³»ç»Ÿæ¦‚è¿°)
2. [è¾“å…¥è¦æ±‚](#è¾“å…¥è¦æ±‚)
3. [å®Œæ•´å·¥ä½œæµç¨‹](#å®Œæ•´å·¥ä½œæµç¨‹)
4. [è¾“å‡ºç»“æœ](#è¾“å‡ºç»“æœ)
5. [å®é™…æ“ä½œæ¼”ç¤º](#å®é™…æ“ä½œæ¼”ç¤º)

---

## ğŸ¯ ç³»ç»Ÿæ¦‚è¿°

### ä¸€å¥è¯è¯´æ˜

> **è¾“å…¥**: ä¸¤æ¬¡ CT æ‰«æï¼ˆDICOM/NIfTI æ ¼å¼ï¼‰  
> **è¾“å‡º**: AI ç”Ÿæˆçš„çºµå‘å¯¹æ¯”è¯Šæ–­æŠ¥å‘Šï¼ˆåŒ…å«ç—…ç¶å˜åŒ–åˆ†æã€RECIST è¯„ä¼°ã€æ²»ç–—å»ºè®®ï¼‰

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NeuroScan AI ç³»ç»Ÿæ¶æ„                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚  è¾“å…¥    â”‚    â”‚  å¤„ç†    â”‚    â”‚  åˆ†æ    â”‚    â”‚  è¾“å‡º    â”‚          â”‚
â”‚  â”‚          â”‚    â”‚          â”‚    â”‚          â”‚    â”‚          â”‚          â”‚
â”‚  â”‚ DICOM/   â”‚â”€â”€â”€â–¶â”‚ é¢„å¤„ç†   â”‚â”€â”€â”€â–¶â”‚ AI åˆ†æ  â”‚â”€â”€â”€â–¶â”‚ è¯Šæ–­æŠ¥å‘Š â”‚          â”‚
â”‚  â”‚ NIfTI    â”‚    â”‚ é…å‡†     â”‚    â”‚ LLM ç”Ÿæˆ â”‚    â”‚ å¯è§†åŒ–   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚       â”‚               â”‚               â”‚               â”‚                 â”‚
â”‚       â–¼               â–¼               â–¼               â–¼                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚ åŸºçº¿æ‰«æ â”‚    â”‚ å™¨å®˜åˆ†å‰² â”‚    â”‚ å˜åŒ–æ£€æµ‹ â”‚    â”‚ HTMLæŠ¥å‘Š â”‚          â”‚
â”‚  â”‚ éšè®¿æ‰«æ â”‚    â”‚ å›¾åƒé…å‡† â”‚    â”‚ RECIST   â”‚    â”‚ PDFå¯¼å‡º  â”‚          â”‚
â”‚  â”‚ æ‚£è€…ä¿¡æ¯ â”‚    â”‚ å·®å¼‚è®¡ç®— â”‚    â”‚ ç‰¹å¾æå– â”‚    â”‚ çƒ­åŠ›å›¾   â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“¥ è¾“å…¥è¦æ±‚

### å¿…éœ€è¾“å…¥

| è¾“å…¥é¡¹ | æ ¼å¼ | è¯´æ˜ |
|--------|------|------|
| **åŸºçº¿æ‰«æ (Baseline)** | DICOM æˆ– NIfTI (.nii.gz) | ç¬¬ä¸€æ¬¡æ£€æŸ¥çš„ CT æ‰«æ |
| **éšè®¿æ‰«æ (Follow-up)** | DICOM æˆ– NIfTI (.nii.gz) | åç»­æ£€æŸ¥çš„ CT æ‰«æ |

### å¯é€‰è¾“å…¥

| è¾“å…¥é¡¹ | æ ¼å¼ | è¯´æ˜ |
|--------|------|------|
| æ‚£è€… ID | å­—ç¬¦ä¸² | ç”¨äºæŠ¥å‘Šæ ‡è¯† |
| æ£€æŸ¥æ—¥æœŸ | YYYY-MM-DD | åŸºçº¿å’Œéšè®¿æ—¥æœŸ |
| åˆ†å‰²æ©ç  | NIfTI (.nii.gz) | é¢„å…ˆæ ‡æ³¨çš„å™¨å®˜/ç—…ç¶æ©ç  |
| å…³æ³¨åŒºåŸŸ | åæ ‡/æ ‡ç­¾ | æŒ‡å®šåˆ†æçš„å™¨å®˜æˆ–åŒºåŸŸ |

### æ”¯æŒçš„æ‰«æç±»å‹

- âœ… èƒ¸éƒ¨ CTï¼ˆè‚ºéƒ¨ã€çºµéš”ï¼‰
- âœ… è…¹éƒ¨ CTï¼ˆè‚ã€è„¾ã€è‚¾ï¼‰
- âœ… å…¨èº« CT
- âœ… å¢å¼º CT / å¹³æ‰« CT

---

## ğŸ”„ å®Œæ•´å·¥ä½œæµç¨‹

### é˜¶æ®µ 1: æ•°æ®è¾“å…¥ä¸é¢„å¤„ç†

```
è¾“å…¥æ–‡ä»¶ â”€â”€â–¶ DICOM è§£æ â”€â”€â–¶ æ ¼å¼è½¬æ¢ â”€â”€â–¶ æ ‡å‡†åŒ–
   â”‚              â”‚              â”‚            â”‚
   â”‚              â–¼              â–¼            â–¼
   â”‚         æå–å…ƒæ•°æ®     è½¬ä¸º NIfTI    é‡é‡‡æ ·åˆ°
   â”‚         (æ‚£è€…ä¿¡æ¯ã€    æ ¼å¼          ç»Ÿä¸€åˆ†è¾¨ç‡
   â”‚          æ‰«æå‚æ•°)                   (1mmÂ³)
```

**å…·ä½“æ­¥éª¤**:

1. **DICOM è§£æ**: è¯»å– DICOM æ–‡ä»¶ï¼Œæå–æ‚£è€…ä¿¡æ¯ã€æ‰«æå‚æ•°
2. **æ ¼å¼è½¬æ¢**: å°† DICOM åºåˆ—è½¬æ¢ä¸º NIfTI æ ¼å¼
3. **æ ‡å‡†åŒ–**: 
   - é‡é‡‡æ ·åˆ°ç»Ÿä¸€åˆ†è¾¨ç‡ (1mm Ã— 1mm Ã— 1mm)
   - è°ƒæ•´æ–¹å‘ä¸ºæ ‡å‡† RAS åæ ‡ç³»
   - HU å€¼çª—å®½çª—ä½è°ƒæ•´

### é˜¶æ®µ 2: å™¨å®˜åˆ†å‰²

```
NIfTI å›¾åƒ â”€â”€â–¶ MONAI æ¨¡å‹ â”€â”€â–¶ åˆ†å‰²æ©ç 
                   â”‚
                   â–¼
              è¯†åˆ« 104 ä¸ª
              è§£å‰–ç»“æ„
              (è‚ºã€è‚ã€è„¾ã€
               è‚¾ã€è„ŠæŸ±ç­‰)
```

**ä½¿ç”¨æ¨¡å‹**: `wholeBody_ct_segmentation` (MONAI Bundle)

**è¾“å‡º**: æ¯ä¸ªå™¨å®˜çš„äºŒå€¼æ©ç 

### é˜¶æ®µ 3: å›¾åƒé…å‡†

```
åŸºçº¿æ‰«æ â”€â”¬â”€â”€â–¶ åˆšæ€§é…å‡† â”€â”€â–¶ éåˆšæ€§é…å‡† â”€â”€â–¶ å¯¹é½åå›¾åƒ
          â”‚       â”‚              â”‚
éšè®¿æ‰«æ â”€â”˜       â–¼              â–¼
              å¹³ç§»ã€æ—‹è½¬      å±€éƒ¨å½¢å˜
              å…¨å±€å¯¹é½        ç²¾ç»†å¯¹é½
```

**é…å‡†ç­–ç•¥**:

1. **åˆšæ€§é…å‡† (Rigid)**: æ ¡æ­£ä½“ä½å·®å¼‚ï¼ˆå¹³ç§» + æ—‹è½¬ï¼‰
2. **éåˆšæ€§é…å‡† (Deformable)**: æ ¡æ­£å‘¼å¸è¿åŠ¨ã€å™¨å®˜å½¢å˜

**è¾“å‡º**: 
- é…å‡†åçš„éšè®¿å›¾åƒ
- å˜å½¢åœº (Deformation Field)

### é˜¶æ®µ 4: å˜åŒ–æ£€æµ‹ä¸é‡åŒ–

```
å¯¹é½åå›¾åƒ â”€â”€â–¶ å·®å¼‚è®¡ç®— â”€â”€â–¶ å˜åŒ–é‡åŒ– â”€â”€â–¶ RECIST è¯„ä¼°
                  â”‚             â”‚              â”‚
                  â–¼             â–¼              â–¼
              å·®å¼‚å›¾åƒ      ä½“ç§¯å˜åŒ–%       CR/PR/SD/PD
              çƒ­åŠ›å›¾        å¯†åº¦å˜åŒ–        åˆ†ç±»
                           æœ€é•¿å¾„å˜åŒ–
```

**åˆ†æå†…å®¹**:

| æŒ‡æ ‡ | è¯´æ˜ |
|------|------|
| ä½“ç§¯å˜åŒ– | ç—…ç¶ä½“ç§¯å¢å‡ç™¾åˆ†æ¯” |
| å¯†åº¦å˜åŒ– | HU å€¼å˜åŒ– |
| æœ€é•¿å¾„å˜åŒ– | RECIST 1.1 æ ‡å‡†æµ‹é‡ |
| å½¢æ€å˜åŒ– | çƒå½¢åº¦ã€è¡¨é¢ç§¯ç­‰ |

**RECIST 1.1 è¯„ä¼°æ ‡å‡†**:

| è¯„ä¼°ç»“æœ | æ ‡å‡† |
|----------|------|
| CR (å®Œå…¨ç¼“è§£) | æ‰€æœ‰é¶ç—…ç¶æ¶ˆå¤± |
| PR (éƒ¨åˆ†ç¼“è§£) | é¶ç—…ç¶ç›´å¾„æ€»å’Œå‡å°‘ â‰¥30% |
| SD (ç–¾ç—…ç¨³å®š) | ä»‹äº PR å’Œ PD ä¹‹é—´ |
| PD (ç–¾ç—…è¿›å±•) | é¶ç—…ç¶ç›´å¾„æ€»å’Œå¢åŠ  â‰¥20% |

### é˜¶æ®µ 5: LLM æ™ºèƒ½æŠ¥å‘Šç”Ÿæˆ

```
åˆ†æç»“æœ â”€â”€â–¶ æç¤ºè¯æ„å»º â”€â”€â–¶ LLM æ¨ç† â”€â”€â–¶ æŠ¥å‘Šç”Ÿæˆ
    â”‚             â”‚             â”‚            â”‚
    â–¼             â–¼             â–¼            â–¼
é‡åŒ–æ•°æ®      ACR æ¨¡æ¿     Llama3.1/    HTML/PDF
RECIST ç»“æœ   åŒ»å­¦æœ¯è¯­     Meditron     æ ¼å¼åŒ–è¾“å‡º
```

**æŠ¥å‘Šå†…å®¹**:

1. **æ‚£è€…ä¿¡æ¯**: IDã€æ£€æŸ¥æ—¥æœŸã€æ‰«æå‚æ•°
2. **å½±åƒæ‰€è§**: å„å™¨å®˜/ç—…ç¶çš„æè¿°
3. **å¯¹æ¯”åˆ†æ**: ä¸åŸºçº¿çš„å˜åŒ–
4. **RECIST è¯„ä¼°**: æ ‡å‡†åŒ–è¯„ä¼°ç»“æœ
5. **è¯Šæ–­æ„è§**: AI ç”Ÿæˆçš„è¯Šæ–­å»ºè®®
6. **éšè®¿å»ºè®®**: ä¸‹ä¸€æ­¥æ£€æŸ¥å»ºè®®

---

## ğŸ“¤ è¾“å‡ºç»“æœ

### ä¸»è¦è¾“å‡º

| è¾“å‡ºé¡¹ | æ ¼å¼ | è¯´æ˜ |
|--------|------|------|
| **è¯Šæ–­æŠ¥å‘Š** | HTML/PDF | å®Œæ•´çš„ ACR æ ‡å‡†æ ¼å¼æŠ¥å‘Š |
| **å·®å¼‚çƒ­åŠ›å›¾** | PNG | å¯è§†åŒ–å˜åŒ–åŒºåŸŸ |
| **é…å‡†ç»“æœ** | NIfTI | å¯¹é½åçš„å›¾åƒ |
| **é‡åŒ–æ•°æ®** | JSON | æ‰€æœ‰æµ‹é‡æ•°æ® |

### æŠ¥å‘Šç¤ºä¾‹ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    çºµå‘å¯¹æ¯”è¯Šæ–­æŠ¥å‘Š                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ‚£è€…ID: P001          æ£€æŸ¥æ—¥æœŸ: 2026-01-24                   â”‚
â”‚ åŸºçº¿æ—¥æœŸ: 2025-10-01   æ£€æŸ¥é—´éš”: 115 å¤©                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚ ã€å½±åƒæ‰€è§ã€‘                                                 â”‚
â”‚ å³è‚ºä¸Šå¶åæ®µè§ä¸€ç»“èŠ‚ç¶ï¼Œå¤§å°çº¦ 12.5mm Ã— 10.2mmï¼Œè¾¹ç•Œæ¸…æ™°ï¼Œ    â”‚
â”‚ å¯†åº¦å‡åŒ€ï¼ŒCT å€¼çº¦ 35 HUã€‚                                    â”‚
â”‚                                                             â”‚
â”‚ ã€å¯¹æ¯”åˆ†æã€‘                                                 â”‚
â”‚ ä¸ 2025-10-01 åŸºçº¿å¯¹æ¯”ï¼š                                     â”‚
â”‚ - å³è‚ºä¸Šå¶ç»“èŠ‚ç”± 10.0mm å¢å¤§è‡³ 12.5mmï¼Œå¢å¤§çº¦ 25%            â”‚
â”‚ - å¯†åº¦æ— æ˜æ˜¾å˜åŒ–                                             â”‚
â”‚ - å½¢æ€ä¿æŒè§„åˆ™                                               â”‚
â”‚                                                             â”‚
â”‚ ã€RECIST 1.1 è¯„ä¼°ã€‘                                          â”‚
â”‚ é¶ç—…ç¶æœ€é•¿å¾„å˜åŒ–: +25%                                       â”‚
â”‚ è¯„ä¼°ç»“æœ: PD (ç–¾ç—…è¿›å±•)                                      â”‚
â”‚                                                             â”‚
â”‚ ã€è¯Šæ–­æ„è§ã€‘                                                 â”‚
â”‚ å³è‚ºä¸Šå¶ç»“èŠ‚è¾ƒå‰å¢å¤§ï¼Œç¬¦åˆç–¾ç—…è¿›å±•æ ‡å‡†ï¼Œå»ºè®®ï¼š                 â”‚
â”‚ 1. èƒ¸éƒ¨ä¸“å®¶ä¼šè¯Š                                              â”‚
â”‚ 2. PET-CT è¿›ä¸€æ­¥è¯„ä¼°                                         â”‚
â”‚ 3. è€ƒè™‘ç©¿åˆºæ´»æ£€æ˜ç¡®æ€§è´¨                                      â”‚
â”‚                                                             â”‚
â”‚ æŠ¥å‘ŠåŒ»å¸ˆ: AI Assistant    å®¡æ ¸åŒ»å¸ˆ: ___________              â”‚
â”‚ æŠ¥å‘Šæ—¥æœŸ: 2026-01-24                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¯è§†åŒ–è¾“å‡º

1. **å¤šå¹³é¢è§†å›¾**: è½´ä½ã€çŸ¢çŠ¶ä½ã€å† çŠ¶ä½å¯¹æ¯”
2. **å·®å¼‚çƒ­åŠ›å›¾**: æ˜¾ç¤ºå˜åŒ–åŒºåŸŸå’Œç¨‹åº¦
3. **3D æ¸²æŸ“**: ç—…ç¶ä¸‰ç»´å¯è§†åŒ–
4. **æ—¶é—´è½´**: å¤šæ—¶é—´ç‚¹å˜åŒ–è¶‹åŠ¿

---

## ğŸ–¥ï¸ å®é™…æ“ä½œæ¼”ç¤º

### æ–¹å¼ä¸€: Web ç•Œé¢æ“ä½œ

#### æ­¥éª¤ 1: å¯åŠ¨ç³»ç»Ÿ

```bash
cd /mnt/ydchen/NeuroScan
./start_demo.sh
```

#### æ­¥éª¤ 2: æ‰“å¼€æµè§ˆå™¨

è®¿é—® `http://localhost:8501`

#### æ­¥éª¤ 3: ä¸Šä¼ æ•°æ®

1. ç‚¹å‡» "ä¸Šä¼ åŸºçº¿æ‰«æ"
2. é€‰æ‹© DICOM æ–‡ä»¶å¤¹æˆ– NIfTI æ–‡ä»¶
3. ç‚¹å‡» "ä¸Šä¼ éšè®¿æ‰«æ"
4. é€‰æ‹©å¯¹åº”æ–‡ä»¶

#### æ­¥éª¤ 4: å¼€å§‹åˆ†æ

1. ç‚¹å‡» "å¼€å§‹çºµå‘åˆ†æ"
2. ç­‰å¾…å¤„ç†å®Œæˆï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰

#### æ­¥éª¤ 5: æŸ¥çœ‹ç»“æœ

1. æŸ¥çœ‹å·®å¼‚çƒ­åŠ›å›¾
2. é˜…è¯» AI ç”Ÿæˆçš„æŠ¥å‘Š
3. å¯¼å‡º PDF æŠ¥å‘Š

---

### æ–¹å¼äºŒ: å‘½ä»¤è¡Œæ“ä½œ

#### å®Œæ•´ç¤ºä¾‹è„šæœ¬

```python
#!/usr/bin/env python3
"""
NeuroScan AI å®Œæ•´å·¥ä½œæµæ¼”ç¤º
"""

import os
import sys
sys.path.insert(0, '/mnt/ydchen/NeuroScan')

import nibabel as nib
import numpy as np
from datetime import datetime

# å¯¼å…¥ NeuroScan æ¨¡å—
from app.services.registration import ImageRegistrator
from app.services.analysis import ChangeDetector, FeatureExtractor
from app.services.report import ReportGenerator

def run_complete_workflow(baseline_path, followup_path, output_dir):
    """
    è¿è¡Œå®Œæ•´çš„çºµå‘åˆ†æå·¥ä½œæµ
    
    å‚æ•°:
        baseline_path: åŸºçº¿æ‰«æè·¯å¾„ (.nii.gz)
        followup_path: éšè®¿æ‰«æè·¯å¾„ (.nii.gz)
        output_dir: è¾“å‡ºç›®å½•
    """
    
    print("=" * 60)
    print("ğŸ¥ NeuroScan AI - çºµå‘åˆ†æå·¥ä½œæµ")
    print("=" * 60)
    
    # ========== é˜¶æ®µ 1: åŠ è½½æ•°æ® ==========
    print("\nğŸ“¥ é˜¶æ®µ 1: åŠ è½½æ•°æ®...")
    
    baseline_nii = nib.load(baseline_path)
    followup_nii = nib.load(followup_path)
    
    baseline_data = baseline_nii.get_fdata()
    followup_data = followup_nii.get_fdata()
    spacing = baseline_nii.header.get_zooms()[:3]
    
    print(f"   åŸºçº¿æ‰«æ: {baseline_data.shape}, åˆ†è¾¨ç‡: {spacing}")
    print(f"   éšè®¿æ‰«æ: {followup_data.shape}")
    
    # ========== é˜¶æ®µ 2: å›¾åƒé…å‡† ==========
    print("\nğŸ”§ é˜¶æ®µ 2: å›¾åƒé…å‡†...")
    
    registrator = ImageRegistrator()
    
    # åˆšæ€§é…å‡†
    print("   æ‰§è¡Œåˆšæ€§é…å‡†...")
    rigid_result = registrator.rigid_registration(
        fixed_image=baseline_data,
        moving_image=followup_data,
        spacing=spacing
    )
    
    # éåˆšæ€§é…å‡†
    print("   æ‰§è¡Œéåˆšæ€§é…å‡†...")
    deformable_result = registrator.deformable_registration(
        fixed_image=baseline_data,
        moving_image=rigid_result['registered_image'],
        spacing=spacing
    )
    
    registered_followup = deformable_result['registered_image']
    print(f"   âœ… é…å‡†å®Œæˆ")
    
    # ========== é˜¶æ®µ 3: å˜åŒ–æ£€æµ‹ ==========
    print("\nğŸ” é˜¶æ®µ 3: å˜åŒ–æ£€æµ‹...")
    
    detector = ChangeDetector(threshold_hu=30)
    
    # è®¡ç®—å·®å¼‚
    diff_map = detector.compute_difference(baseline_data, registered_followup)
    
    # é‡åŒ–å˜åŒ–
    changes = detector.quantify_changes(baseline_data, registered_followup)
    
    print(f"   å¹³å‡å˜åŒ–: {changes['mean_change']:.2f} HU")
    print(f"   å˜åŒ–ä½“ç§¯: {changes['changed_volume_mm3']:.2f} mmÂ³")
    
    # ========== é˜¶æ®µ 4: ç‰¹å¾æå– ==========
    print("\nğŸ“Š é˜¶æ®µ 4: ç‰¹å¾æå–...")
    
    extractor = FeatureExtractor(spacing=spacing)
    
    # åˆ›å»ºç¤ºä¾‹ ROI (è¿™é‡Œä½¿ç”¨å·®å¼‚å›¾çš„é˜ˆå€¼)
    roi_mask = np.abs(diff_map) > 30
    
    if roi_mask.sum() > 0:
        features = extractor.extract_features(baseline_data, roi_mask)
        print(f"   ä½“ç§¯: {features.get('volume_mm3', 0):.2f} mmÂ³")
        print(f"   å¹³å‡å¯†åº¦: {features.get('mean_hu', 0):.2f} HU")
    
    # ========== é˜¶æ®µ 5: RECIST è¯„ä¼° ==========
    print("\nğŸ“‹ é˜¶æ®µ 5: RECIST 1.1 è¯„ä¼°...")
    
    # æ¨¡æ‹Ÿ RECIST è¯„ä¼° (å®é™…åº”åŸºäºç—…ç¶æµ‹é‡)
    baseline_diameter = 10.0  # mm
    followup_diameter = 12.5  # mm
    change_percent = (followup_diameter - baseline_diameter) / baseline_diameter * 100
    
    if change_percent <= -30:
        recist = "PR (éƒ¨åˆ†ç¼“è§£)"
    elif change_percent >= 20:
        recist = "PD (ç–¾ç—…è¿›å±•)"
    else:
        recist = "SD (ç–¾ç—…ç¨³å®š)"
    
    print(f"   åŸºçº¿ç›´å¾„: {baseline_diameter} mm")
    print(f"   éšè®¿ç›´å¾„: {followup_diameter} mm")
    print(f"   å˜åŒ–: {change_percent:+.1f}%")
    print(f"   è¯„ä¼°ç»“æœ: {recist}")
    
    # ========== é˜¶æ®µ 6: ç”ŸæˆæŠ¥å‘Š ==========
    print("\nğŸ“ é˜¶æ®µ 6: ç”Ÿæˆ AI æŠ¥å‘Š...")
    
    generator = ReportGenerator(llm_backend="ollama")
    
    # å‡†å¤‡æŠ¥å‘Šæ•°æ®
    report_data = {
        'patient_id': 'DEMO_001',
        'baseline_date': '2025-10-01',
        'followup_date': datetime.now().strftime('%Y-%m-%d'),
        'baseline_findings': {
            'description': 'å³è‚ºä¸Šå¶åæ®µè§ä¸€ç»“èŠ‚ç¶',
            'size_mm': baseline_diameter,
            'density_hu': 35
        },
        'followup_findings': {
            'description': 'å³è‚ºä¸Šå¶åæ®µç»“èŠ‚',
            'size_mm': followup_diameter,
            'density_hu': 38
        },
        'changes': {
            'size_change_percent': change_percent,
            'volume_change_percent': changes.get('volume_change_percent', 0),
            'density_change': 3
        },
        'recist_evaluation': recist
    }
    
    # ç”ŸæˆæŠ¥å‘Š
    report = generator.generate_longitudinal_report(**report_data)
    
    # ä¿å­˜æŠ¥å‘Š
    os.makedirs(output_dir, exist_ok=True)
    report_path = os.path.join(output_dir, 'longitudinal_report.html')
    generator.save_report(report, report_path.replace('.html', ''), format='html')
    
    print(f"   âœ… æŠ¥å‘Šå·²ä¿å­˜: {report_path}")
    
    # ========== å®Œæˆ ==========
    print("\n" + "=" * 60)
    print("âœ… å·¥ä½œæµå®Œæˆ!")
    print("=" * 60)
    print(f"\nğŸ“ è¾“å‡ºæ–‡ä»¶:")
    print(f"   - è¯Šæ–­æŠ¥å‘Š: {report_path}")
    
    return {
        'registered_image': registered_followup,
        'diff_map': diff_map,
        'changes': changes,
        'recist': recist,
        'report_path': report_path
    }


if __name__ == "__main__":
    # ä½¿ç”¨ Learn2Reg æ•°æ®æ¼”ç¤º
    baseline = "/mnt/ydchen/NeuroScan/data/processed/real_lung_001/baseline.nii.gz"
    followup = "/mnt/ydchen/NeuroScan/data/processed/real_lung_001/followup.nii.gz"
    output = "/mnt/ydchen/NeuroScan/output/workflow_demo"
    
    if os.path.exists(baseline) and os.path.exists(followup):
        run_complete_workflow(baseline, followup, output)
    else:
        print("è¯·å…ˆè¿è¡Œ python scripts/download_real_data.py ä¸‹è½½æµ‹è¯•æ•°æ®")
```

#### è¿è¡Œæ¼”ç¤º

```bash
cd /mnt/ydchen/NeuroScan
python docs/workflow_demo.py
```

---

### æ–¹å¼ä¸‰: API è°ƒç”¨

#### RESTful API å·¥ä½œæµ

```bash
# 1. ä¸Šä¼ åŸºçº¿æ‰«æ
curl -X POST "http://localhost:8000/api/v1/ingest" \
  -F "file=@baseline.zip" \
  -F "scan_type=baseline"

# å“åº”: {"scan_id": "scan_001", "status": "uploaded"}

# 2. ä¸Šä¼ éšè®¿æ‰«æ
curl -X POST "http://localhost:8000/api/v1/ingest" \
  -F "file=@followup.zip" \
  -F "scan_type=followup"

# å“åº”: {"scan_id": "scan_002", "status": "uploaded"}

# 3. æ‰§è¡Œçºµå‘åˆ†æ
curl -X POST "http://localhost:8000/api/v1/analyze/longitudinal" \
  -H "Content-Type: application/json" \
  -d '{
    "baseline_scan_id": "scan_001",
    "followup_scan_id": "scan_002",
    "analysis_options": {
      "registration": true,
      "segmentation": true,
      "recist": true,
      "generate_report": true
    }
  }'

# å“åº”: {"task_id": "task_001", "status": "processing"}

# 4. æŸ¥è¯¢åˆ†æçŠ¶æ€
curl "http://localhost:8000/api/v1/tasks/task_001"

# å“åº”: {"task_id": "task_001", "status": "completed", "progress": 100}

# 5. è·å–æŠ¥å‘Š
curl "http://localhost:8000/api/v1/reports/task_001" -o report.html
```

---

## ğŸ“Š æ€§èƒ½å‚è€ƒ

| é˜¶æ®µ | è€—æ—¶ | GPU æ˜¾å­˜ |
|------|------|----------|
| æ•°æ®åŠ è½½ | ~5 ç§’ | - |
| å™¨å®˜åˆ†å‰² | ~30 ç§’ | 4 GB |
| å›¾åƒé…å‡† | ~60 ç§’ | 2 GB |
| å˜åŒ–æ£€æµ‹ | ~10 ç§’ | - |
| æŠ¥å‘Šç”Ÿæˆ | ~30 ç§’ | 6 GB |
| **æ€»è®¡** | **~2-3 åˆ†é’Ÿ** | **~8 GB** |

---

## â“ å¸¸è§é—®é¢˜

### Q: ä¸¤æ¬¡æ‰«æçš„åˆ†è¾¨ç‡ä¸åŒæ€ä¹ˆåŠï¼Ÿ

ç³»ç»Ÿä¼šè‡ªåŠ¨é‡é‡‡æ ·åˆ°ç»Ÿä¸€åˆ†è¾¨ç‡ï¼Œæ— éœ€æ‰‹åŠ¨å¤„ç†ã€‚

### Q: æ”¯æŒ MRI å—ï¼Ÿ

ç›®å‰ä¸»è¦é’ˆå¯¹ CT ä¼˜åŒ–ï¼ŒMRI æ”¯æŒæ­£åœ¨å¼€å‘ä¸­ã€‚

### Q: æŠ¥å‘Šå¯ä»¥è‡ªå®šä¹‰æ¨¡æ¿å—ï¼Ÿ

å¯ä»¥ï¼Œä¿®æ”¹ `app/services/report/templates/` ä¸‹çš„æ¨¡æ¿æ–‡ä»¶ã€‚

### Q: å¦‚ä½•å¤„ç†å¤šä¸ªç—…ç¶ï¼Ÿ

ç³»ç»Ÿæ”¯æŒå¤šç—…ç¶è¿½è¸ªï¼Œä¼šåˆ†åˆ«è®¡ç®—æ¯ä¸ªç—…ç¶çš„å˜åŒ–ã€‚

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»ï¼š
- ğŸ“§ æŠ€æœ¯æ”¯æŒ: support@neuroscan.ai
- ğŸ“– æ–‡æ¡£: https://docs.neuroscan.ai
- ğŸ› Issue: https://github.com/your-org/NeuroScan/issues

